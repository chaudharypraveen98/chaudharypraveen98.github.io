<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="A scraper which scrapes the quotes from a website using the Scrapy framework" />
        <title>QuotesTutorial</title><meta name="description" content="This contains all the projects made by Praveen chaudhary">
        <meta name="keywords" content="chaudharypraveen98,Praveen Chaudhary,devilunknown, Praveen Chaudhary projects, QuotesTutorial">
        <meta name="robots" content="index, follow">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="language" content="English">
        <meta name="revisit-after" content="2 days">
        <meta name="author" content="@chaudharypraveen98">
        <meta name="twitter:title" content="Praveen Chaudhary">
        <meta name="twitter:description" content=" Personal Projects Section">
        <meta name="twitter:image" content="https://pbs.twimg.com/profile_images/1366311960468332546/EidYygUt_400x400.jpg">
        <meta name="twitter:card" content="summary_large_image">
        <meta property="og:title" content="Praveen Chaudhary - a Full Stack Developer" />
        <meta property="og:url" content="https://www.linkedin.com/in/chaudharypraveen98/" />
        <meta property="og:description" content="This is the personal portfolio page which contains all the projects. I am a Full Stack Developer, Rest Api Developer, Data Analsyt" />
        <meta property="og:image" content="https://media-exp1.licdn.com/dms/image/C5603AQHRamUaMrdA9g/profile-displayphoto-shrink_400_400/0/1597315489941?e=1629936000&v=beta&t=GjvQu_r0n3F2EtGkaRYSF6pH8vRdgx5lsD1-w8dc8gY" />
        <meta property="og:type" content="Portfolio.Projects" />
        <link rel="shortcut icon" href="./../favicon.ico" type="image/x-icon">
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
    </head>
    <body>
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
            <div class="container px-4 px-lg-5">
                <a class="navbar-brand" href="index.html">QuotesTutorial</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto py-4 py-lg-0">
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="index.html">Home</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="https://chaudharypraveen98.github.io/about.html">About</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="https://chaudharypraveen98.github.io/project-preview/">Latest Works</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="https://chaudharypraveen98.github.io/contact.html">Contact</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Page Header-->
        <header class="masthead" style="background-image: url('assets/img/post-bg.jpg')">
            <div class="container position-relative px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <div class="post-heading">
                            <h1>QuotesTutorial</h1>
                            <h2 class="subheading">A scraper which scrapes the quotes from a website using the Scrapy framework</h2>
                            <span class="meta">
                                Posted by
                                <a href="https://github.com/chaudharypraveen98">Praveen Chaudhary</a>
                                on 16 October 2020
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Post Content-->
        <article class="mb-4">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <h3>Topics -> scrapy-framework, python, scraping</h3>                        <h5>Source Code Link -> <u><a href="https://github.com/chaudharypraveen98/QuotesTutorial">GitHub</a></u></h5>
                        <p><strong>What We are going to do?</strong></p>
                        <ol>
                            <li>Setting up the Scrapy Project</li>
                            <li>Writing a Scraper to scrapes quotes</li>
                            <li>Cleaning and Pipelining to store data in sqlite3 database</li>
                            <li>Setting up Fake user agents and proxies</li>
                        </ol>
                        <h2 class="section-heading">Step 1 -> Setting up the Scrapy Project</h2>
                        <p><h3>Creating a QuotesTutorial project</h3></p>
                        <p><strong>Before creating , we must know about <b>Scrapy</b></strong></p>
                        <p>Scrapy is a free and open-source web-crawling framework written in Python. Originally designed for web scraping, it can also be used to extract data using APIs or as a general-purpose web crawler.</p>
                        <p>To initialize the project</p>
                        <pre>scrapy startproject quotes-tutorial</pre>
                        <p>This will create a tutorial directory with the following contents:</p>
<pre>
quotes-tutorial/
    scrapy.cfg            # deploy configuration file

    quotes-tutorial/             # project's Python module, you'll import your code from here
        __init__.py

        items.py          # project items definition file

        middlewares.py    # project middlewares file

        pipelines.py      # project pipelines file

        settings.py       # project settings file

        spiders/          # a directory where you'll later put your spiders
            __init__.py
</pre>
                        <h2 class="section-heading">Step 2 -> Writing our scraper</h2>
                        <p>It will extract quotes from <a href="https://www.goodreads.com">Good Reads website</a></p>
                        <p><b>Before moving ahead , we must be aware of the selectors</b></p>
                        <p><strong>What are selectors/locators?</strong></p>
                        <p>A CSS Selector is a combination of an element selector and a value which identifies the web element within a web page.</p>
                        <p><b>The choice of locator depends largely on your Application Under Test</b></p>
                        <b>Id</b>
                        <p>An element’s id in XPATH is defined using: “[@id='example']” and in CSS using: “#” - ID's must be unique within the DOM.</p>
                        <p>Examples:</p>
                        <pre>
XPath: //div[@id='example']
CSS: #example
                      </pre>
                      <p><b>Element Type</b></p>
                       <p>The previous example showed //div in the xpath. That is the element type, which could be input for a text box or button, img for an image, or "a" for a link. </p>
                        
                        <pre>
Xpath: //input or
Css: =input
                      </pre>
                      <p><b>Direct Child</b></p>
                        <p>HTML pages are structured like XML, with children nested inside of parents. If you can locate, for example, the first link within a div, you can construct a string to reach it. A direct child in XPATH is defined by the use of a “/“, while on CSS, it’s defined using “>”. </p>
                        <p>Examples:</p>
                        <pre>                        
XPath: //div/a
CSS: div > a
                      </pre>
                      <p><b>Child or Sub-Child</b></p>
                        <p>Writing nested divs can get tiring - and result in code that is brittle. Sometimes you expect the code to change, or want to skip layers. If an element could be inside another or one of its children, it’s defined in XPATH using “//” and in CSS just by a whitespace.</p>
                        <p>Examples:</p>
                        <pre>
                        
XPath: //div//a
CSS: div a
                      </pre>
                      <p><b>Class</b></p>
                        <p>For classes, things are pretty similar in XPATH: “[@class='example']” while in CSS it’s just “.” </p>
                        <p>Examples:</p>
                        <pre>
XPath: //div[@class='example']
CSS: .example
                        </pre>
                        <p>We have inherited the spider class from scrapy-framework. The <tt>page_number</tt> is the next page to be scraped</p>
                        <p><tt>start_urls</tt> provide the entry point to the scraper if no url is explicitly given.</p>
                        <p><tt>_parse</tt> function is main function from where the scraping starts.</p>
                        <p>We have used the css selectors explained above.</p>
                        <pre>
import scrapy

from ..items import QuotesItem


class QuotesScraper(scrapy.Spider):
    page_number = 2
    name = "QuotesScraper"
    start_urls = ["https://www.goodreads.com/quotes/tag/inspirational"]

    def _parse(self, response, **kwargs):
        item = QuotesItem()
        for quote in response.css(".quote"):
            title = quote.css(".quoteText::text").extract_first()
            author = quote.css(".authorOrTitle::text").extract_first()
            item["title"] = title
            item["author"] = author
            yield item

        # Uncomment the below lines if you want to scrape all the pages in that website and comment the rest uncomment line

        # next_btn = response.css("a.next_page::attr(href)").get()
        # if next_btn is not None:
        #     yield response.follow(next_btn, callback=self._parse())
        next_page=f"https://www.goodreads.com/quotes/tag/inspirational?page={QuotesScraper.page_number}"
        if QuotesScraper.page_number < 3:
            QuotesScraper.page_number += 1
            yield response.follow(next_page, callback=self._parse)

                        </pre>
                        <p><strong>But what are QuotesItem here?</strong></p>
                        <p>Items are containers that will be loaded with the scraped data; they work like simple python dicts but provide additional protection against populating undeclared fields, to prevent typos.</p>
                        <pre>
import scrapy


class QuotesItem(scrapy.Item):
    # define the fields for your item here like:
    title = scrapy.Field()
    author = scrapy.Field()
                        </pre>
                        <h2 class="section-heading">Step 3 -> Pipelining to store the data in sqlite3 database</h2>
                        <pre>
import sqlite3


class QuotesPipeline:
    def __init__(self):
        self.create_connection()
        self.create_table()

    def process_item(self, item, spider):
        self.db_store(item)
        return item

    def create_connection(self):
        self.conn = sqlite3.connect("quotes.db")
        self.curr = self.conn.cursor()

    def create_table(self):
        self.curr.execute("""DROP TABLE IF EXISTS quote_table""")
        self.curr.execute("""create table quote_table( title text, author text)""")

    def db_store(self, item):
        self.curr.execute("""insert into quote_table values(?,?)""", (
            item["title"],
            item["author"]
        ))
        self.conn.commit()
</pre>
                        <p>Initiate a QuotesPipeline Class. </p>
                        <p><tt>__init__</tt> functions creates a connection between the sqlite3 database and the program with the help of <tt>create_connection</tt> function. It is also responsible for creating a Quotes table with the <tt>create_table</tt> function.</p>
                        <p><tt>process_item</tt> function will process all the quotes items and will store into the database with the help of <tt>db_store</tt> function.</p>                    
                        
                        <h2 class="section-heading">Step 4 -> Setting up Fake user agents and proxies</h2>
                        <p>As we are scraping on a large scale we need to avoid banning our IP</p>
                        <p>We are using two libraries : -</p>
                        <ol>
                            <li><a href="https://github.com/rejoiceinhope/scrapy-proxy-pool">scrapy-proxy-pool</a></li>
                            <li><a href="https://pypi.org/project/scrapy-user-agents/">scrapy-user-agents</a></li>
                        </ol>
                        <p><strong>1. scrapy-proxy-pool</strong></p>
                        <p>It will provide a bunch of proxies to ensure security of our real IP</p>
                        <p>Enable this middleware by adding the following settings to your settings.py:</p>
                        <pre>PROXY_POOL_ENABLED = True</pre>
                        <p>Then add rotating_proxies middlewares to your DOWNLOADER_MIDDLEWARES:</p>
                        <pre>
DOWNLOADER_MIDDLEWARES = {
    # ...
    'scrapy_proxy_pool.middlewares.ProxyPoolMiddleware': 610,
    'scrapy_proxy_pool.middlewares.BanDetectionMiddleware': 620,
    # ...
}
                        </pre>
                        <p>After this all requests will be proxied using proxies.</p>

                        <p><strong>2. scrapy-user-agents</strong></p>
                        <p>Random User-Agent middleware picks up User-Agent strings based on Python User Agents and MDN.</p>
                        <p>Turn off the built-in UserAgentMiddleware and add RandomUserAgentMiddleware.</p>

                        <pre>
DOWNLOADER_MIDDLEWARES = {
    'scrapy.downloadermiddlewares.useragent.UserAgentMiddleware': None,
    'scrapy_user_agents.middlewares.RandomUserAgentMiddleware': 400,
}
</pre>

                        <h2 class="section-heading">Deployment</h2>
                        <p>Running Scrapy spiders in your local machine is very convenient for the (early) development stage, but not so much when you need to execute long-running spiders or move spiders to run in production continuously. This is where the solutions for deploying Scrapy spiders come in.</p>
                        <p>Popular choices for deploying Scrapy spiders are:</p>
                        <ol>
                            <li><a href="https://github.com/scrapy/scrapyd">Scrapyd (open source)</a></li>
                            <li><a href="https://www.zyte.com/scrapy-cloud/">Zyte Scrapy Cloud (cloud-based)</a></li>
                        </ol>
                        <h2 class="section-heading">Web Preview / Output</h2>
                        <a href="https://raw.githubusercontent.com/chaudharypraveen98/QuotesTutorial/master/quotes.JPG"><img class="img-fluid" src="https://raw.githubusercontent.com/chaudharypraveen98/QuotesTutorial/master/quotes.JPG" alt="web preview" /></a>
                        <span class="caption text-muted">Web preview on deployment</span>
                        <p>
                            Placeholder text by
                            <a href="https://chaudharypraveen98.github.io/">Praveen Chaudhary</a>
                            &middot; Images by
                            <a href="hhttps://chaudharypraveen98.github.io/binarybeast/">Binary Beast</a>
                        </p>
                    </div>
                </div>
            </div>
        </article>
        <!-- Footer-->
        <footer class="border-top">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <ul class="list-inline text-center">
                            <li class="list-inline-item">
                                <a href="https://twitter.com/chaudhpraveen98">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="https://www.linkedin.com/in/chaudharypraveen98/">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="https://github.com/chaudharypraveen98">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                        </ul>
                        <div class="small text-center text-muted fst-italic">Copyright &copy; Praveen Chaudhary 2021</div>
                    </div>
                </div>
            </div>
        </footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
    </body>
</html>
