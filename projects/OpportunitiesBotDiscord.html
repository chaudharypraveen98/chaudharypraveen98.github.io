<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="A bot that can extract the internship posts from the internshala and store in the repl database and gives response when asked." />
        <title>Opportunities Bot Discord</title>
        <meta name="keywords" content="chaudharypraveen98,Praveen Chaudhary,devilunknown, Praveen Chaudhary projects, Shoty - A new era of music">
        <meta name="robots" content="index, follow">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="language" content="English">
        <meta name="revisit-after" content="2 days">
        <meta name="author" content="@chaudharypraveen98">
        <meta name="twitter:title" content="Praveen Chaudhary">
        <meta name="twitter:description" content=" Personal Projects Section">
        <meta name="twitter:image" content="https://pbs.twimg.com/profile_images/1366311960468332546/EidYygUt_400x400.jpg">
        <meta name="twitter:card" content="summary_large_image">
        <meta property="og:title" content="Praveen Chaudhary - a Full Stack Developer" />
        <meta property="og:url" content="https://www.linkedin.com/in/chaudharypraveen98/" />
        <meta property="og:description" content="This is the personal portfolio page which contains all the projects. I am a Full Stack Developer, Rest Api Developer, Data Analsyt" />
        <meta property="og:image" content="https://media-exp1.licdn.com/dms/image/C5603AQHRamUaMrdA9g/profile-displayphoto-shrink_400_400/0/1597315489941?e=1629936000&v=beta&t=GjvQu_r0n3F2EtGkaRYSF6pH8vRdgx5lsD1-w8dc8gY" />
        <meta property="og:type" content="Portfolio.Projects" />
        <link rel="shortcut icon" href="./../favicon.ico" type="image/x-icon">
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
    </head>
    <body>
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
            <div class="container px-4 px-lg-5">
                <a class="navbar-brand" href="index.html">Opportunities Bot Discord</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto py-4 py-lg-0">
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="index.html">Home</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="https://chaudharypraveen98.github.io/about.html">About</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="https://chaudharypraveen98.github.io/project-preview/">Latest Works</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="https://chaudharypraveen98.github.io/contact.html">Contact</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Page Header-->
        <header class="masthead" style="background-image: url('assets/img/post-bg.jpg')">
            <div class="container position-relative px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <div class="post-heading">
                            <h1>Opportunities Bot Discord</h1>
                            <h2 class="subheading">A bot that can extract the internship posts from the internshala and store in the repl database and gives response when asked.</h2>
                            <span class="meta">
                                Posted by
                                <a href="https://github.com/chaudharypraveen98">Praveen Chaudhary</a>
                                on 11 March 2021
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Post Content-->
        <article class="mb-4">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <h3>Topics -> discord-bot, python, requests-html, bot</h3>
                        <h5>Preview Link -> <u><a href=""></a></u></h5>
                        <h5>Source Code Link -> <u><a href="">GitHub</a></u></h5>
                        <p><strong>What We are going to do?</strong></p>
                        <ol>
                          <li>Extracting the Opportunities from Internshala and Freelancer.</li>
                          <li>Initializing the Discord client.</li>
                          <li>Making commands, caching it for further use and providing response in real time to users</li>
                        </ol>

                        <p><strong>Some Important Concept</strong></p>
                        <p>We will be using the requests-html for scraping.</p>
                        <p><b>But, What is requests-html?</b></p>
                        <p>This library intends to make parsing HTML (e.g. scraping the web) as simple and intuitive as possible.</p>
                        <ul>
                            <li><strong>Full JavaScript support</strong>!</li>
                            <li><em>CSS Selectors</em> (a.k.a jQuery-style, thanks to PyQuery).</li>
                            <li><em>XPath Selectors</em>, for the faint of heart.</li>
                            <li>Mocked user-agent (like a real web browser).</li>
                            <li>Automatic following of redirects.</li>
                            <li>Connectionâ€“pooling and cookie persistence.</li>
                            <li>The Requests experience you know and love, with magical parsing abilities.</li>
                            <li><strong>Async Support</strong></li>
                        </ul>

                        <p><b>Requests ?</b></p>
                        <p>Requests is a Python HTTP library, released under the Apache License 2.0. The goal of the project is to make HTTP requests simpler and more human-friendly. </p>

                        <p><b>Dicord Python</b></p>
                        <p>A modern, easy to use, feature-rich, and async ready API wrapper for Discord written in Python.</p>


                        <p><strong>Installing Required libraries :- </strong></p>
                        <pre>
pip install requests
pip install requests_html
pip install discord
                        </pre>
                        <h2 class="section-heading">Step 1 => Extracting the Opportunities from Internshala and Freelancer</h2>
                        <p>We will requests-html to extract the opportunities from Freelancer and Internshala. We will use the css selectors to loacte the element.</p>
                        <p>We must have url depending on the input tag. We can frame url using our custom function.</p>
                        <p><b>For Internshala Url</b></p>
                        <pre>
# It will start the scraper. If It has a keyword then url will be based upon that.
def start_scraper(keyword=None):
    if keyword:
        url = f"https://internshala.com/internships/keywords-{keyword}"
    else:
        url = "https://internshala.com/internships"
    return get_internship(url)
                        </pre>

                        <p><b>For Freelancer Url</b></p>
                        <pre>
# Starter function for freelancing function
def get_freelance(keyword=None):
    random_keywords = ['python', 'java', 'web', 'javascript', 'graphics']
    if keyword:
        url = f"https://www.freelancer.com/jobs/?keyword={keyword}"
    else:
        random_keyword = random.choice(random_keywords)
        url = f"https://www.freelancer.com/jobs/?keyword={random_keyword}"
    res_html = pharse_and_extract(url)
    freelance_works = extract_from_freelancer(res_html)
    return freelance_works
                        </pre>
                        
                        <p><strong>Fetching the data from the url using Request-html</strong></p>
                        <pre>
def url_to_text(url):
    r = requests.get(url)
    if r.status_code == 200:
        html_text = r.text
        return html_text
                        </pre>
                        <p><b>r.status_code</b> will check the response status code. If it is valid then proceed to other part.</p>
                        <p><strong>Parsing the Html code using HTML from requests-HTML</strong></p>
                        <pre>                  
# It will parse the html data into structure way
def pharse_and_extract(url, name=2020):
    html_text = url_to_text(url)
    if html_text is None:
        return ""
    r_html = HTML(html=html_text)
    return r_html
                        </pre>

                        <p><strong>Getting internship from Internshala</strong></p>
                        <p>It will find all the post using the css class. Then it will loop through all the posts and get all the required details like stipend, duration, organisation name and so on.</p>
                        <pre>
# it will loop through all the internship and extract valuable data
def get_internship(url):
    internships = []
    res_data = pharse_and_extract(url)
    opportunties = res_data.find(".individual_internship")
    for opportunity in opportunties:
        title = opportunity.find(".company a", first=True).text
        internship_link = opportunity.find(".profile a", first=True).attrs['href']
        organisation = opportunity.find(".company .company_name", first=True).text
        organisation_internships = opportunity.find(".company_name a", first=True).attrs['href']
        location = opportunity.find(".location_link", first=True).text
        start_data = opportunity.find("#start-date-first", first=True).text.split("\xa0immediately")[-1]
        ctc = opportunity.find(".stipend", first=True).text
        apply_lastes_by = opportunity.xpath(".//span[contains(text(),'Apply By')]/../../div[@class='item_body']",
                                            first=True).text
        duration = opportunity.xpath(".//span[contains(text(),'Duration')]/../../div[@class='item_body']",
                                     first=True).text
        internships.append({
            'title': title,
            'organisation': organisation,
            'location': location,
            'start_data': start_data,
            'ctc': ctc,
            'apply_lastes_by': apply_lastes_by,
            'duration': duration,
            'organisation_internships': f"https://internshala.com{organisation_internships}",
            'internship_link': f"https://internshala.com{internship_link}"
        })
    return internships
                        </pre>

                        <p><strong>Getting Jobs using Freelancer Work</strong></p>
                        <p>Same like above, First it will all post using the common class and then loop through it ie. <code>(.JobSearchCard-item)</code> class.</p>
                        <pre>
# It will extract the freelancing opportunities
def extract_from_freelancer(res_html):
    freelance_works = []
    opportunities = res_html.find(".JobSearchCard-item")
    for opportunity in opportunities:
        title = opportunity.find(".JobSearchCard-primary-heading a", first=True).text
        freelance_link = opportunity.find(".JobSearchCard-primary-heading a", first=True).attrs['href']
        avg = opportunity.find(".JobSearchCard-primary-price")
        if avg:
            avg_proposal = avg[0].text
        else:
            avg_proposal = "Not mentioned"
        apply_lastes_by = opportunity.find(".JobSearchCard-primary-heading-days", first=True).text
        desc = opportunity.find(".JobSearchCard-primary-description", first=True).text
        freelance_works.append({
            'title': title,
            'description': desc,
            'apply_lastes_by': apply_lastes_by,
            'avg_proposal': avg_proposal,
            'freelance_link': f"https://www.freelancer.com/{freelance_link}"
        })
    return freelance_works
                        </pre>

                        <h2 class="section-heading">Step 2 => Initializing the Discord client</h2>
                        <p>It will initialize the client so that we can use later when needed.</p>
                        <p><b>Please make sure to put the channel ID</b></p>
                        <pre>
                        </pre>
@client.event
async def on_ready():
    channel = client.get_channel(&lt;&gt;)
    print("We have logged in as", client.user)


                        <h2 class="section-heading">Step 3 => Making commands, caching it for further use and providing response in real time to users</h2>
                        <p><strong>What is Repl Database?</strong></p>
                        <p>Replit Database is a simple, user-friendly key-value store inside of every repl. No configuration is required; you can get started right away!</p>
                        <p>What we are going to do in the step?</p>
                        <ol>
                            <li>Make commands, so that we may know what the user want depending on the input supplied</li>
                            <li>Checking is the data is present in database or not.</li>
                            <li>If present, then provide the response using our custom formatter</li>
                            <li>If not, Scrape then provide response using formatter</li>
                        </ol>

                        <p><b>1. Initializing the commands</b></p>
                        <pre>
@client.event
async def on_message(message):
    if message.author == client.user:
        return
    if message.content.startswith('$hello'):
        await message.channel.send(f"Hello {message.author}")
    if message.content.startswith('$reset internship'):
        del db['internship']
        await message.channel.send("cleared internship")
    if message.content.startswith('$reset freelance'):
        del db['freelance']
        await message.channel.send("cleared freelance")
    if message.content.startswith('$reset'):
        db.clear()
        await message.channel.send("cleared all")
    if message.content.startswith('$help'):
        db.clear()
        await message.channel.send(
            "------------------\nwrite $internship with space separated field or keyword \n\nExample \n$internship python \n\nFor Freelance \n----------------------\nwrite $freelance with space separated\n----------------------- \n\nExample \n$freelance python \n\nOr \n\n $freelance \nfor random freelance work")

    if message.content.startswith('$internship'):
        .... 

    if message.content.startswith('$freelance'):
        ....
                        </pre>

                        <p><b>2. Checking Repl Database</b></p>
                        <pre>
....
if message.content.startswith('$freelance'):
    key_list = message.content.split(" ")
    if len(key_list) > 1:
        keyword = key_list[1]
        if 'freelance' in db.keys():
            if keyword in db['freelance'].keys():
                free_result = random.choice(db['freelance'][keyword])

            else:
                freelance_works = get_freelance(keyword=keyword)
                db['freelance'][keyword] = freelance_works
                free_result = random.choice(freelance_works)
....
                        </pre>

                        <p><b>If data is found in database</b></p>
                        <pre>
....
result_message = format_message(free_result)
await message.channel.send(result_message)
....
                        </pre>

                        <p><b>If not, scrape then response</b></p>
                        <pre>
...
else:
    db['freelance'] = {}
    freelance_works = get_freelance(keyword=keyword)
    db['freelance'][keyword] = freelance_works
    free_result = random.choice(freelance_works)
result_message = format_message(free_result)
await message.channel.send(result_message)
...
                        </pre>
                        <p><strong>Whole Code at Once</strong></p>
                        <pre>
@client.event
async def on_message(message):
    if message.author == client.user:
        return
    if message.content.startswith('$hello'):
        await message.channel.send(f"Hello {message.author}")
    if message.content.startswith('$reset internship'):
        del db['internship']
        await message.channel.send("cleared internship")
    if message.content.startswith('$reset freelance'):
        del db['freelance']
        await message.channel.send("cleared freelance")
    if message.content.startswith('$reset'):
        db.clear()
        await message.channel.send("cleared all")
    if message.content.startswith('$help'):
        db.clear()
        await message.channel.send(
            "------------------\nwrite $internship with space separated field or keyword \n\nExample \n$internship python \n\nFor Freelance \n----------------------\nwrite $freelance with space separated\n----------------------- \n\nExample \n$freelance python \n\nOr \n\n $freelance \nfor random freelance work")

    if message.content.startswith('$internship'):
        keyword = message.content.split(" ")[-1]
        print(keyword)
        if 'internship' in db.keys():
            if keyword in db['internship'].keys():
                result = random.choice(db[keyword])
            else:
                opportunities = start_scraper(keyword=keyword)
                db['internship'][keyword] = opportunities
                result = random.choice(opportunities)
        else:
            db['internship'] = {}
            opportunities = start_scraper(keyword=keyword)
            db['internship'][keyword] = opportunities
            result = random.choice(opportunities)

        result_message = format_message(result)
        await message.channel.send(result_message)

    if message.content.startswith('$freelance'):
        key_list = message.content.split(" ")
        if len(key_list) > 1:
            keyword = key_list[1]
            if 'freelance' in db.keys():
                if keyword in db['freelance'].keys():
                    free_result = random.choice(db['freelance'][keyword])

                else:
                    freelance_works = get_freelance(keyword=keyword)
                    db['freelance'][keyword] = freelance_works
                    free_result = random.choice(freelance_works)

            else:
                db['freelance'] = {}
                freelance_works = get_freelance(keyword=keyword)
                db['freelance'][keyword] = freelance_works
                free_result = random.choice(freelance_works)
            result_message = format_message(free_result)
            await message.channel.send(result_message)

        else:
            if 'freelance' in db.keys():
                if 'random' in db['freelance'].keys():
                    free_result = random.choice(db['freelance']['random'])
                else:
                    data = get_freelance()
                    db['freelance']['random'] = data
                    free_result = random.choice(data)
            else:
                db['freelance'] = {}
                data = get_freelance()
                db['freelance']['random'] = data
                free_result = random.choice(data)

            result_message = format_message(free_result)
            await message.channel.send(result_message)
                        </pre>
                        <h2 class="section-heading">Deployment</h2>
                        <p>You can only deploy on <a href="https://replit.com/">Repl</a> as we are using the Repl Database.</p>
                        
                        <h2 class="section-heading">Web Preview / Output</h2>
                        <a href="https://raw.githubusercontent.com/chaudharypraveen98/OpportunitiesBotDiscord/master/opportunities.JPG"><img class="img-fluid" src="https://raw.githubusercontent.com/chaudharypraveen98/OpportunitiesBotDiscord/master/opportunities.JPG" alt="web preview" /></a>
                        <span class="caption text-muted">Web preview on deployment</span>
                        <p>
                            Placeholder text by
                            <a href="https://chaudharypraveen98.github.io/">Praveen Chaudhary</a>
                            &middot; Images by
                            <a href="hhttps://chaudharypraveen98.github.io/binarybeast/">Binary Beast</a>
                        </p>
                    </div>
                </div>
            </div>
        </article>
        <!-- Footer-->
        <footer class="border-top">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <ul class="list-inline text-center">
                            <li class="list-inline-item">
                                <a href="https://twitter.com/chaudhpraveen98">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="https://www.linkedin.com/in/chaudharypraveen98/">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="https://github.com/chaudharypraveen98">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                        </ul>
                        <div class="small text-center text-muted fst-italic">Copyright &copy; Praveen Chaudhary 2021</div>
                    </div>
                </div>
            </div>
        </footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
    </body>
</html>
