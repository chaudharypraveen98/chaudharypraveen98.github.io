<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <title>Scraping Stackoverflow with Rust</title>
        <meta name="description" content="A scraper that will extract question, link and title from stackoverflow. This scraper is inspired from Kadekillary Scarper with updated libraries and some more features added.">
        <meta name="keywords" content="chaudharypraveen98,Praveen Chaudhary,devilunknown, Praveen Chaudhary projects, Praveen Chaudhary, Scraping Stackoverflow with Rust">
        <meta name="robots" content="index, follow">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="language" content="English">
        <meta name="revisit-after" content="2 days">
        <meta name="author" content="@chaudharypraveen98">
        <meta name="twitter:title" content="Praveen Chaudhary">
        <meta name="twitter:description" content=" Personal Projects Section">
        <meta name="twitter:image" content="https://pbs.twimg.com/profile_images/1366311960468332546/EidYygUt_400x400.webp">
        <meta name="twitter:card" content="summary_large_image">
        <meta property="og:title" content="Praveen Chaudhary - a Full Stack Developer" />
        <meta property="og:url" content="https://www.linkedin.com/in/chaudharypraveen98/" />
        <meta property="og:description" content="This is the personal portfolio page which contains all the projects. I am a Full Stack Developer, Rest Api Developer, Data Analsyt" />
        <meta property="og:image" content="https://media-exp1.licdn.com/dms/image/C5603AQHRamUaMrdA9g/profile-displayphoto-shrink_400_400/0/1597315489941?e=1629936000&v=beta&t=GjvQu_r0n3F2EtGkaRYSF6pH8vRdgx5lsD1-w8dc8gY" />
        <meta property="og:type" content="Portfolio.Projects" />
        <link rel="shortcut icon" href="./../favicon.ico" type="image/x-icon">
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
    </head>
    <body>
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
            <div class="container px-4 px-lg-5">
                <a class="navbar-brand" href="index.html">Scraping Stackoverflow with Rust</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto py-4 py-lg-0">
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="index.html">Home</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="https://chaudharypraveen98.github.io/about.html">About</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="https://chaudharypraveen98.github.io/project-preview/">Latest Projects</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="contact.html">Contact</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Page Header-->
        <header class="masthead" style="background-image: url('assets/img/post-bg.webp')">
            <div class="container position-relative px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <div class="post-heading">
                            <h1>Scraping Stackoverflow with Rust</h1>
                            <h2 class="subheading">A scraper that will extract question, link and title from stackoverflow. This scraper is inspired from Kadekillary Scarper with updated libraries and some more features added.</h2>
                            <span class="meta">
                                Posted by
                                <a href="https://github.com/chaudharypraveen98">Praveen Chaudhary</a>
                                on 11 June 2021
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Post Content-->
        <article class="mb-4">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">

                        <h3>Topics -> rust, reqwest, selectrs, scraping</h3>
                        <h5>Preview Link -> <u><a href="https://drive.google.com/file/d/1SjQ0U1JZF6nn74PgpHDnurwvjEGGl-VH/preview">stackoverflow-scraping-with-rust</a></u></h5>
                        <h5>Source Code Link -> <u><a href="https://github.com/chaudharypraveen98/stackoverflow-scraping-with-rust">GitHub</a></u></h5>
                        
                        <img class="img-fluid" src="https://raw.githubusercontent.com/chaudharypraveen98/stackoverflow-scraping-with-rust/master/Rust%20Scraping.webp" alt="stackoverflow-scraping-with-rust"/>                        
                        
                        <p><strong>What We are going to do?</strong></p>
                        <ol>
                            <li>Getting argument from the command line using Clap library</li>
                            <li>Make a request using the Reqwest library</li>
                            <li>Scraping using the Selectrs library</li>
                        </ol>


                        <p><strong>Libraries required : -</strong></p>
                        <ol>
                            <li><a href="https://crates.io/crates/reqwest"><b>Reqwest</b></a> => An ergonomic, batteries-included HTTP Client for Rust.</li>
                            <li><a href="https://crates.io/crates/select"><b>Select</b></a> => A Rust library to extract useful data from HTML documents, suitable for web scraping</li>
                            <li><a href="https://crates.io/crates/clap"><b>Clap</b></a> => A simple-to-use, efficient, and full-featured library for parsing command line arguments and subcommands.</li>
                            <li><a href="https://crates.io/crates/rand"><b>Rand</b></a> => Easy random value generation and usage via the Rng, SliceRandom and IteratorRandom traits</li>
                        </ol>

                        <p><strong>Installing Libraries</strong></p>
                        <p><b>Simple add the following libraries in Cargo.toml</b></p>
                        <pre>
[dependencies]
reqwest = { version = "0.10", features = ["json"] }
tokio = { version = "0.2", features = ["full"] }
select = "0.6.0-alpha.1"
clap = "2.33.3"
rand = "0.8.4"
                        </pre>

                        
                        <p><strong>Before moving ahead, We must be aware of Css selectors</strong></p>
                        <p><strong>What are selectors/locators?</strong></p>
                        <p>A <b>CSS Selector</b> is a combination of an element selector and a value which identifies the web element within a web page.</p>
                        <p><b>The choice of locator depends largely on your Application Under Test</b></p>
                        <b>Id</b>
                        <p>An element’s id in XPATH is defined using: “[@id='example']” and in CSS using: “#” - ID's must be unique within the DOM.</p>
                        <p>Examples:</p>
                        <pre>
XPath: //div[@id='example']
CSS: #example
                      </pre>
                      <p><b>Element Type</b></p>
                       <p>The previous example showed //div in the xpath. That is the element type, which could be input for a text box or button, img for an image, or "a" for a link. </p>
                        
                        <pre>
Xpath: //input or
Css: =input
                      </pre>
                      <p><b>Direct Child</b></p>
                        <p>HTML pages are structured like XML, with children nested inside of parents. If you can locate, for example, the first link within a div, you can construct a string to reach it. A direct child in XPATH is defined by the use of a “/“, while on CSS, it’s defined using “>”. </p>
                        <p>Examples:</p>
                        <pre>                        
XPath: //div/a
CSS: div > a
                      </pre>
                      <p><b>Child or Sub-Child</b></p>
                        <p>Writing nested divs can get tiring - and result in code that is brittle. Sometimes you expect the code to change, or want to skip layers. If an element could be inside another or one of its children, it’s defined in XPATH using “//” and in CSS just by a whitespace.</p>
                        <p>Examples:</p>
                        <pre>
XPath: //div//a
CSS: div a
                      </pre>
                      <p><b>Class</b></p>
                        <p>For classes, things are pretty similar in XPATH: “[@class='example']” while in CSS it’s just “.” </p>
                        <p>Examples:</p>
                        <pre>
XPath: //div[@class='example']
CSS: .example
                        </pre>

                        
                        <h2 class="section-heading">Step 1 -> Getting argument from the command line using Clap library</h2>
                        <p>We are using the Clap library to get the argument from the command line.</p>
                        <p>Thare are three cases</p>
                        <ol>
                            <li><b>Only tag is provided</b> => We will get only the posts from the input tag with default no of post i.e 16</li>
                            <li><b>Only count is supplies</b> => We will get only input number of post from any random topic using the Rand library</li>
                            <li><b>Both count and tag</b> => We will get input number of post of input tag</li>
                        </ol>
                        <p>First we initialize the command line app names StackOverflow Scraper. Then mention all the three cases with there short and long name.</p>

                        <pre>
fn main() {
    let matches = App::new("StackOverflow Scraper")
        .version("1.0")
        .author("Praveen Chaudhary &lt;chaudharypraveen98@gmail.com&gt;")
        .about("It will scrape questions from stackoverflow depending on the tag.")
        .arg(
            Arg::with_name("tag")
                .short("t")
                .long("tag")
                .takes_value(true)
                .help("takes tag and scrape according to this"),
        )
        .arg(
            Arg::with_name("count")
                .short("c")
                .long("count")
                .takes_value(true)
                .help("gives n count of posts"),
        )
        .get_matches();
        ....
        ....
</pre>
                        <p>Once we have mentioned all the cases. Now we need to extract the argument value using the match which help us to find a particular pattern</p>
                        <pre>
                            fn main() {
                                .....
                                .....
                            
                                if matches.is_present("tag") && matches.is_present("count") {
                                    let url = format!(
                                        "https://stackoverflow.com/questions/tagged/{}?tab=Votes",
                                        matches.value_of("tag").unwrap()
                                    );
                                    let count: i32 = matches.value_of("count").unwrap().parse::<i32>().unwrap();
                                    stackoverflow_post(&url, count as usize);
                                } else if matches.is_present("tag") {
                                    let url = format!(
                                        "https://stackoverflow.com/questions/tagged/{}?tab=Votes",
                                        matches.value_of("tag").unwrap()
                                    );
                                    stackoverflow_post(&url, 16);
                                } else if matches.is_present("count") {
                                    let url = get_random_url();
                                    let count: i32 = matches.value_of("count").unwrap().parse::<i32>().unwrap();
                                    stackoverflow_post(&url, count as usize);
                                } else {        
                                    let url = get_random_url();        
                                    stackoverflow_post(&url, 16);
                                }
                            }
                        </pre>
                        <p>In the above code, we have used the <tt>stackoverflow_post</tt> function. We will learn about this in <b>Step 3</b></p>

                         <h2 class="section-heading">Step 2 -> Make a request using the Reqwest library</h2>
                        <p>We will use the reqwest library to make a get request to the stackoverflow website customized with the input tag</p>
                        <pre>
#[tokio::main]
async fn hacker_news(url: &str, count: usize) -> Result<(), reqwest::Error> {
    let resp = reqwest::get(url).await?;
    ....
</pre>

                        <h2 class="section-heading">Step 3 -> Scraping using the Selectrs library</h2>
                        <p>We will use the css selectors to get the question post from the stackoverflow</p>

                        <pre>
#[tokio::main]
async fn hacker_news(url: &str, count: usize) -> Result<(), reqwest::Error> {
    ..... 
    ..... 

    let document = Document::from(&*resp.text().await?);

    for node in document.select(Class("mln24")).take(count) {
        let question = node.select(Class("excerpt")).next().unwrap().text();
        let title_element = node.select(Class("question-hyperlink")).next().unwrap();
        let title = title_element.text();
        let question_link = title_element.attr("href").unwrap();
        let votes = node.select(Class("vote-count-post")).next().unwrap().text();
        let views = node.select(Class("views")).next().unwrap().text();
        let striped_views = views.trim();
        let tags = node
            .select(Attr("class", "post-tag grid--cell"))
            .map(|tag| tag.text())
            .collect::&lt;Vec&lt;_&gt;&gt;();
        let answer = node
            .select(Or(
                Attr("class", "status answered-accepted").descendant(Name("strong")),
                Attr("class", "status answered").descendant(Name("strong")),
            ))
            .next()
            .unwrap()
            .text();
        println!("Question       => {}", question);
        println!("Question-link  => https://stackoverflow.com{}",question_link);
        println!("Question-title => {}", title);
        println!("Votes          => {}", votes);
        println!("Views          => {}", striped_views);
        println!("Tags           => {}", tags.join(" ,"));
        println!("Answers        => {}", answer);
        println!("-------------------------------------------------------------\n");
    }
    Ok(())
}
                        </pre>
                        <h2 class="section-heading">Complete Code</h2>
                        <pre>
extern crate clap;
extern crate reqwest;
extern crate select;
extern crate tokio;

use clap::{App, Arg};
use rand::seq::SliceRandom;
use select::document::Document;
use select::predicate::{Attr, Class, Name, Or, Predicate};

fn main() {
    let matches = App::new("StackOverflow Scraper")
        .version("1.0")
        .author("Praveen Chaudhary &lt;chaudharypraveen98@gmail.com&gt;")
        .about("It will scrape questions from stackoverflow depending on the tag.")
        .arg(
            Arg::with_name("tag")
                .short("t")
                .long("tag")
                .takes_value(true)
                .help("takes tag and scrape according to this"),
        )
        .arg(
            Arg::with_name("count")
                .short("c")
                .long("count")
                .takes_value(true)
                .help("gives n count of posts"),
        )
        .get_matches();

    if matches.is_present("tag") && matches.is_present("count") {
        let url = format!(
            "https://stackoverflow.com/questions/tagged/{}?tab=Votes",
            matches.value_of("tag").unwrap()
        );
        let count: i32 = matches.value_of("count").unwrap().parse::<i32>().unwrap();
        hacker_news(&url, count as usize);
    } else if matches.is_present("tag") {
        let url = format!(
            "https://stackoverflow.com/questions/tagged/{}?tab=Votes",
            matches.value_of("tag").unwrap()
        );
        hacker_news(&url, 16);
    } else if matches.is_present("count") {
        let url = get_random_url();
        let count: i32 = matches.value_of("count").unwrap().parse::<i32>().unwrap();
        hacker_news(&url, count as usize);
    } else {        
        let url = get_random_url();        
        hacker_news(&url, 16);
    }
}

#[tokio::main]
async fn hacker_news(url: &str, count: usize) -> Result&lt;(), reqwest::Error&gt; {
    let resp = reqwest::get(url).await?;
    // println!("body = {:?}", resp.text().await?);
    // assert!(resp.status().is_success());
    let document = Document::from(&*resp.text().await?);

    for node in document.select(Class("mln24")).take(count) {
        let question = node.select(Class("excerpt")).next().unwrap().text();
        let title_element = node.select(Class("question-hyperlink")).next().unwrap();
        let title = title_element.text();
        let question_link = title_element.attr("href").unwrap();
        let votes = node.select(Class("vote-count-post")).next().unwrap().text();
        let views = node.select(Class("views")).next().unwrap().text();
        let striped_views = views.trim();
        let tags = node
            .select(Attr("class", "post-tag grid--cell"))
            .map(|tag| tag.text())
            .collect::&lt;Vec&lt;_&gt;&gt;();
        let answer = node
            .select(Or(
                Attr("class", "status answered-accepted").descendant(Name("strong")),
                Attr("class", "status answered").descendant(Name("strong")),
            ))
            .next()
            .unwrap()
            .text();
        println!("Question       => {}", question);
        println!("Question-link  => https://stackoverflow.com{}",question_link);
        println!("Question-title => {}", title);
        println!("Votes          => {}", votes);
        println!("Views          => {}", striped_views);
        println!("Tags           => {}", tags.join(" ,"));
        println!("Answers        => {}", answer);
        println!("-------------------------------------------------------------\n");
    }
    Ok(())
}

// Getting random tag
fn get_random_url() -> String {
    let default_tags = vec!["python", "rust", "c#", "android", "html", "javascript"];
    let random_tag = default_tags.choose(&mut rand::thread_rng()).unwrap();
    let url = format!(
        "https://stackoverflow.com/questions/tagged/{}?tab=Votes",
        random_tag
    );
    url.to_string()
}
                        </pre>
                        <h2 class="section-heading">How to run our scraper?</h2>
                        <ol>
                            <li>Build the executable by <code>cargo build</code>
                                </li>
                            <li>Run by <code>./target/debug/stackoverflow-scraping-with-rust -t &lt;tag&gt; -c &lt;count&gt;</code>
                                &lt; tag &gt; is the topic from which you want to scrape &lt; count &gt; is the number of posts/threads to be scraped. Note the maximum limit is 16
                                Like this <code>./target/debug/stackoverflow-scraping-with-rust -t java -c 1</code></li>
                            </ol>
                        <h2 class="section-heading">Deployment</h2>
                        <p>You can deploy on <a href="https://www.heroku.com/">Heroku</a> with the help of <a href="https://circleci.com/">Circle CI</a></p>
                        <p>You can read more about on <a href="https://circleci.com/blog/rust-cd/">CircleCI Blog</a></p>

                        <h2 class="section-heading">Web Preview / Output</h2>
                        <a href="https://drive.google.com/file/d/1SjQ0U1JZF6nn74PgpHDnurwvjEGGl-VH/preview">
                            <iframe src="https://drive.google.com/file/d/1SjQ0U1JZF6nn74PgpHDnurwvjEGGl-VH/preview" width="640" height="480" allow="autoplay"></iframe>
                        </a>
                        <span class="caption text-muted">Web preview on deployment</span>
                        <p>
                            Placeholder text by
                            <a href="https://chaudharypraveen98.github.io/">Praveen Chaudhary</a>
                            &middot; Images by
                            <a href="hhttps://chaudharypraveen98.github.io/binarybeast/">Binary Beast</a>
                        </p>
                    </div>
                </div>
            </div>
        </article>
        <!-- Footer-->
        <footer class="border-top">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <ul class="list-inline text-center">
                            <li class="list-inline-item">
                                <a href="https://twitter.com/chaudhpraveen98">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="https://www.linkedin.com/in/chaudharypraveen98/">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="https://github.com/chaudharypraveen98">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                        </ul>
                        <div class="small text-center text-muted fst-italic">Copyright &copy; Praveen Chaudhary 2021</div>
                    </div>
                </div>
            </div>
        </footer>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
    </body>
</html>

        